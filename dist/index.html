<div><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/checkbox",extend:{name:"@makeform/common"},i18n:{en:{"其它":"Other","other-error":"Other checked, but empty"},"zh-TW":{"其它":"其它","other-error":"勾選了其它，但未填"}}},init:function(e){return e.pubsub.fire("subinit",{mod:mod(e)})}};mod=function(e){var l,t,r,n,o,i,a,c,f,d,h,s,v;l=e.root,t=e.ctx,r=e.data,n=e.parent,o=e.t,i=e.i18n;a=t.ldview;c={value:{list:[],other:{enabled:false,text:""}}};f="_"+Math.random().toString(36).substring(2);d=function(e){if(typeof e==="object"){return e.value}else{return e}};h=function(e){if(typeof e==="object"){return o(e.label)}else{return o(e)}};s=function(t){var e;e=(c.values||[]).filter(function(e){return d(e)===t})[0];e=e&&e.label?e.label:e;return e?o(e):typeof t==="string"?o(t):t};v=function(e){return in$(e,(c.values||[]).map(function(e){return d(e)}))};return{init:function(e){var t,i,r,u=this;t=function(){var e;c.other=(e=u.mod.info.config).other||(e.other={});c.values=(u.mod.info.config||{}).values||[];return c.viewopt=(u.mod.info.config||{}).view||{}};t();this.on("meta",function(){return t()});this.on("change",function(e){var t;c.value=e||{};c.value.list=((t=c.value).list||(t.list=[])).filter(function(e){return v(e)});return u.mod.child.view.render(["input","option","other-text","other-check"])});i=function(e){var t;e==null&&(e={});if(!c.value){c.value={}}if(e.list!=null){c.value.list=e.list}c.value.list=c.value.list.filter(function(e){return v(e)});if(e.other){if(e.other.enabled!=null){((t=c.value).other||(t.other={})).enabled=e.other.enabled}if(e.other.text!=null){((t=c.value).other||(t.other={})).text=e.other.text}}return u.value(c.value)};return this.mod.child.view=r=new a({root:l,action:{click:{"other-check":function(e){var t;t=e.node;return i({other:{enabled:!!t.checked}})}},input:{"other-text":function(e){var t;t=e.node;return i({other:{text:t.value}})}}},text:{"other-prompt":function(e){var t,r;t=e.node;if(r=(c.other||{}).prompt){return o(r)}else{return o("其它")}}},handler:{content:function(e){var t,r,n;t=e.node;r=u.isEmpty()?"n/a":(u.content()||[]).map(function(e){return s(e)}).join(", ")||"n/a";t.textContent=r;n=!!c.viewopt.mode&&c.viewopt.mode!=="text";return t.classList.toggle("d-none",n)},input:function(e){var t,r;t=e.node;t.classList.toggle("text-danger",u.status()===2);r=c.viewopt.mode&&c.viewopt.mode==="full";return t.classList.toggle("m-edit",!r)},other:function(e){var t;t=e.node;return t.classList.toggle("d-none",!c.other.enabled)},"other-check":function(e){var t,r;t=e.node;if(!u.mod.info.meta.readonly){t.removeAttribute("disabled")}else{t.setAttribute("disabled",null)}return t.checked=!!((r=c.value||(c.value={})).other||(r.other={})).enabled},"other-text":function(e){var t,r;t=e.node;if(!u.mod.info.meta.readonly){t.removeAttribute("readonly")}else{t.setAttribute("readonly",null)}return t.value=((r=c.value||(c.value={})).other||(r.other={})).text||""},option:{list:function(){return c.values||[]},key:function(e){return d(e)},view:{action:{change:{checkbox:function(e){var t,r,n,o;t=e.node,r=e.ctx;n=Array.from(l.querySelectorAll("input[type=checkbox]")).filter(function(e){return!!e.checked}).map(function(e){return e.value});o={list:n};return i(o)}}},handler:{"@":function(e){var t;t=e.node;return t.style.flexBasis=(u.mod.info.config||{}).layout==="block"?"100%":""},checkbox:function(e){var t,r,n,o,i;t=e.node,r=e.ctx;t.setAttribute("name",f);t.setAttribute("value",d(r));t.checked=in$(d(r),(c.value||{}).list||[]);n=c.viewopt.mode&&c.viewopt.mode==="full";o=u.mode()==="view";i=o&&n?true:!u.mod.info.meta.readonly?false:true;if(i){return t.setAttribute("disabled","")}else{return t.removeAttribute("disabled")}}},text:{text:function(e){var t,r;t=e.node,r=e.ctx;return h(r)}}}}}})},render:function(){return this.mod.child.view.render()},isEmpty:function(t){var e,r;e=this.content(t)||[];e=e.filter(function(e){if(v(e)){return true}if(!(t.other||(t.other={})).enabled){return false}return e===t.other.text});r=Array.isArray(e)?!e.length:!e;if(((this.mod.info.config||{}).other||{}).requireOnCheck&&t&&(t.other||(t.other={})).enabled){return false}return r},content:function(e){var t,r;e==null&&(e={});t=e.list||[];r=c.other.enabled&&(e.other||(e.other={})).enabled&&e.other.text?[e.other.text]:[];return t=t.concat(r)},validate:function(){var t=this;return Promise.resolve().then(function(){var e;if(!((t.mod.info.config||{}).other||{}).requireOnCheck){return}e=t.value();if(e&&(e.other||{}).enabled&&!(e.other||{}).text){return["other-error"]}})}}};function in$(e,t){var r=-1,n=t.length>>>0;while(++r<n)if(e===t[r])return true;return false}</script><div plug="body"><div class="m-edit has-tips manual" ld="input error-root"><div class="d-flex g-2 flex-wrap"><label class="mb-0 mr-2 clickable d-flex" ld-each="option"><input class="mr-1" ld="checkbox" type="checkbox"><span ld="text"></span></label></div><div class="mt-2" ld="other"><label class="clickable d-flex align-items-center"><input class="mr-1" ld="other-check" type="checkbox"><div class="mr-2 text-nowrap" ld="other-prompt"></div><input class="form-control form-control-sm" type="text" ld="other-text"></label></div><div class="hover-tip tip-sm"><div ld-each="error"></div></div></div><div class="m-view" ld="content"></div></div></div>
