<div><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/checkbox",extend:{name:"@makeform/common"},host:{name:"@grantdash/composer"},i18n:{en:{"其它":"Other","other-error":"Other checked, but empty",config:{other:{enabled:{name:"enable 'other' option",desc:"show an 'other' option when enabled"}}}},"zh-TW":{"其它":"其它","other-error":"勾選了其它，但未填",config:{other:{enabled:{name:"使用「其它」選項",desc:"啟用時，顯示一個額外的「其它」選項"}}}}}},init:function(e){var t=this;e.pubsub.on("inited",function(e){e==null&&(e={});return import$(t,e)});return e.pubsub.fire("subinit",{mod:mod.call(this,e)})}};mod=function(e){var a,t,n,r,l,c,o,f,d,s,h,i,v,m,p,u=this;a=e.root,t=e.ctx,n=e.data,r=e.parent,l=e.t,c=e.i18n,o=e.host;f=t.ldview;d={value:{list:[],other:{enabled:false,text:""}}};s="_"+Math.random().toString(36).substring(2);h=function(){return u.hitf};i=function(e){if(typeof e==="string"){return e}else{return(e!=null?e.value:void 8)||h().totext(e!=null?e.label:void 8)}};v=function(e){return in$(e,(d.values||[]).map(function(e){return p(e)}))};m=function(){return Date.now()+"-"+(m.idx=(m.idx||0)+1)+"-"+Math.random().toString(36).substring(2)};p=function(e){return e.key||i(e)};this.client=function(){var e=this;return{minibar:[],meta:{config:{other:{enabled:{type:"boolean",name:"config.other.enabled.name",desc:"config.other.enabled.desc"}}}},render:function(){return e.widget.mod.child.view.render()},sample:function(){var e;return{config:{values:[{key:m(),label:h().wrap((e={},e[c.language+""]="Option 1",e))},{key:m(),label:h().wrap((e={},e[c.language+""]="Option 2",e))},{key:m(),label:h().wrap((e={},e[c.language+""]="Option 3",e))}]}}}}};return{init:function(){var o,e,i,t,u=this;o=function(t){var e;e=(d.values||[]).filter(function(e){return p(e)===t})[0];e=e&&e.label?e.label:e;if(typeof e==="object"){return h().totext(e)}return e?l(e):typeof t==="string"?l(t):t};e=function(){var e;d.other=(e=u.mod.info.config).other||(e.other={});d.values=(u.mod.info.config||{}).values||[];return d.viewopt=(u.mod.info.config||{}).view||{}};e();this.on("meta",function(){return e()});this.on("change",function(e){var t;d.value=e||{};d.value.list=((t=d.value).list||(t.list=[])).filter(function(e){return v(e)});return u.mod.child.view.render(["input","option","other-text","other-check"])});i=function(e){var t;e==null&&(e={});if(!d.value){d.value={}}if(e.list!=null){d.value.list=e.list}d.value.list=d.value.list.filter(function(e){return v(e)});if(e.other){if(e.other.enabled!=null){((t=d.value).other||(t.other={})).enabled=e.other.enabled}if(e.other.text!=null){((t=d.value).other||(t.other={})).text=e.other.text}}return u.value(d.value)};return this.mod.child.view=t=new f({root:a,action:{click:{"other-prompt":h().edit({obj:function(e){var t,n,r,o;t=e.ctx;n=(r=(o=h().get()).config||(o.config={})).other||(r.other={});return n.prompt=typeof n.prompt==="string"?{}:n.prompt||{}}}),"other-check":function(e){var t;t=e.node;return i({other:{enabled:!!t.checked}})},add:function(e){var t,n,r,o,i;t=e.node,n=e.views;r={key:m(),label:h().wrap((o={},o[c.language+""]="Untitled",o))};((o=(i=h().get()).config||(i.config={})).values||(o.values=[])).push(r);h().set();return n[0].render()}},input:{"other-text":function(e){var t;t=e.node;return i({other:{text:t.value}})}}},handler:{"other-prompt":h().render({obj:function(){var e,t,n,r;return(!(e=(t=h().get())!=null?(n=t.config)!=null?(r=n.other)!=null?r.prompt:void 8:void 8:void 8)?"":typeof e!=="string"?e:e)||"其它"}}),content:function(e){var t,n,r;t=e.node;n=u.isEmpty()?"n/a":(u.content()||[]).map(function(e){return o(e)}).join(", ")||"n/a";t.textContent=n;r=!!d.viewopt.mode&&d.viewopt.mode!=="text";return t.classList.toggle("d-none",r)},input:function(e){var t,n;t=e.node;t.classList.toggle("text-danger",u.status()===2);n=d.viewopt.mode&&d.viewopt.mode==="full";return t.classList.toggle("m-edit",!n)},other:function(e){var t;t=e.node;return t.classList.toggle("d-none",!d.other.enabled)},"other-check":function(e){var t,n;t=e.node;if(!u.mod.info.meta.readonly){t.removeAttribute("disabled")}else{t.setAttribute("disabled",null)}return t.checked=!!((n=d.value||(d.value={})).other||(n.other={})).enabled},"other-text":function(e){var t,n;t=e.node;if(!u.mod.info.meta.readonly){t.removeAttribute("readonly")}else{t.setAttribute("readonly",null)}return t.value=((n=d.value||(d.value={})).other||(n.other={})).text||""},option:{list:function(){var e,t;e=((t=h().get().config)!=null?t.values:void 8)||[];if(Array.isArray(e)){return e}else if(e){return[e]}else{return[]}},key:function(e){return p(e)},view:{action:{change:{checkbox:function(e){var t,n,r,o;t=e.node,n=e.ctx;r=Array.from(a.querySelectorAll("input[type=checkbox]")).filter(function(e){return!!e.checked}).map(function(e){return e.value});o={list:r};return i(o)}},click:{"@":function(e){var t,n,r;t=e.node,n=e.evt;if(!(t.parentNode&&(r=ld$.find(t.parentNode,"[ld=editor]",0)))){return}n.stopPropagation();return n.preventDefault()},remove:function(e){var t,n,r,o,i;t=e.node,n=e.ctx,r=e.views;o=(i=h().get()).config||(i.config={});o.values=(o.values||(o.values=[])).filter(function(e){return p(e)!==p(n)});return h().set()},text:h().edit({obj:function(e){var t;t=e.ctx;return t.label||(t.label={})}})}},handler:{"@":function(e){var t;t=e.node;return t.style.flexBasis=(u.mod.info.config||{}).layout==="block"?"100%":""},checkbox:function(e){var t,n,r,o,i;t=e.node,n=e.ctx;t.setAttribute("name",s);t.setAttribute("value",p(n));t.checked=in$(p(n),(d.value||{}).list||[]);r=d.viewopt.mode&&d.viewopt.mode==="full";o=u.mode()==="view";i=o&&r?true:!u.mod.info.meta.readonly?false:true;if(i){return t.setAttribute("disabled","")}else{return t.removeAttribute("disabled")}},text:h().render({obj:function(e){var t;t=e.ctx;return t.label||t}})}}}}})},render:function(){return this.mod.child.view.render()},isEmpty:function(t){var e,n;e=this.content(t)||[];e=e.filter(function(e){if(v(e)){return true}if(!(t.other||(t.other={})).enabled){return false}return e===t.other.text});n=Array.isArray(e)?!e.length:!e;if(((this.mod.info.config||{}).other||{}).requireOnCheck&&t&&(t.other||(t.other={})).enabled){return false}return n},content:function(e){var t,n;e==null&&(e={});t=e.list||[];n=d.other.enabled&&(e.other||(e.other={})).enabled&&e.other.text?[e.other.text]:[];return t=t.concat(n)},validate:function(){var t=this;return Promise.resolve().then(function(){var e;if(!((t.mod.info.config||{}).other||{}).requireOnCheck){return}e=t.value();if(e&&(e.other||{}).enabled&&!(e.other||{}).text){return["other-error"]}})}}};function import$(e,t){var n={}.hasOwnProperty;for(var r in t)if(n.call(t,r))e[r]=t[r];return e}function in$(e,t){var n=-1,r=t.length>>>0;while(++n<r)if(e===t[n])return true;return false}</script><div plug="body"><div class="m-edit" ld="input"><div class="my-2 has-tips manual" ld="error-root"><div class="d-flex g-2 flex-wrap"><label class="mb-0 mr-2 clickable d-flex" ld-each="option"><input class="mr-1" ld="checkbox" type="checkbox"><div class="d-flex align-items-center"><span ld="text"></span><i class="i-close text-sm ml-1 cps-hover cps-remove" ld="remove"></i></div></label><div class="clickable rounded-sm bg-dark cps-add" ld="add">＋</div></div><div class="mt-2" ld="other"><label class="clickable d-flex align-items-center"><input class="mr-1" ld="other-check" type="checkbox"><div class="mr-2 text-nowrap" ld="other-prompt"></div><input class="form-control form-control-sm" type="text" ld="other-text" style="flex:1 0 5em"></label></div><div class="hover-tip tip-sm"><div ld-each="error"></div></div></div></div><div class="m-view" ld="content"></div></div></div>
